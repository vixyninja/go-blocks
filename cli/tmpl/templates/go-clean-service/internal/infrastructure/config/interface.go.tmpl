package config

import (
	"time"
)

// TODO: move to common package
const (
	EnvironmentDevelopment = "dev"
	EnvironmentStaging     = "stag"
	EnvironmentProduction  = "prod"
)

const (
	ServerModeDebug   = "debug"
	ServerModeRelease = "release"
)

const (
	LogLevelDebug = "debug"
	LogLevelInfo  = "info"
	LogLevelWarn  = "warn"
	LogLevelError = "error"
)

const (
	LogFormatJSON = "json"
	LogFormatText = "text"
)

type AppConfig struct {
	Mode     string         `mapstructure:"mode"`
	Server   ServerConfig   `mapstructure:"server"`
	Database DatabaseConfig `mapstructure:"database"`
	Log      LogConfig      `mapstructure:"log"`
}

func (c *AppConfig) GetServer() ServerConfig {
	return c.Server
}

func (c *AppConfig) GetDatabase() DatabaseConfig {
	return c.Database
}

func (c *AppConfig) GetLog() LogConfig {
	return c.Log
}

func (c *AppConfig) GetMode() string {
	return c.Mode
}

type Config interface {
	Validate() error
	GetServer() ServerConfig
	GetDatabase() DatabaseConfig
	GetLog() LogConfig
	GetMode() string
}

type ServerConfig struct {
	TZ             string   `mapstructure:"tz" json:"tz"`
	Port           string   `mapstructure:"port" json:"port"`
	Mode           string   `mapstructure:"mode" json:"mode"`
	Timeout        int      `mapstructure:"timeout" json:"timeout"`
	ReadTimeout    int      `mapstructure:"read_timeout" json:"read_timeout"`
	WriteTimeout   int      `mapstructure:"write_timeout" json:"write_timeout"`
	MaxHeaderBytes int      `mapstructure:"max_header_bytes" json:"max_header_bytes"`
	AllowedOrigins []string `mapstructure:"allowed_origins" json:"allowed_origins"`
	EnableCORS     bool     `mapstructure:"enable_cors" json:"enable_cors"`
	EnablePprof    bool     `mapstructure:"enable_pprof" json:"enable_pprof"`
	EnableMetrics  bool     `mapstructure:"enable_metrics" json:"enable_metrics"`
}

type DatabaseConfig struct {
	Host            string        `mapstructure:"host" json:"host"`
	Port            string        `mapstructure:"port" json:"port"`
	User            string        `mapstructure:"user" json:"user"`
	Password        string        `mapstructure:"password" json:"password"`
	DBName          string        `mapstructure:"dbname" json:"dbname"`
	SSLMode         string        `mapstructure:"sslmode" json:"sslmode"`
	TZ              string        `mapstructure:"tz" json:"tz"`
	MaxIdleConns    int           `mapstructure:"max_idle_conns" json:"max_idle_conns"`
	MaxOpenConns    int           `mapstructure:"max_open_conns" json:"max_open_conns"`
	ConnMaxLifetime time.Duration `mapstructure:"conn_max_lifetime" json:"conn_max_lifetime"`
	AutoMigrate     bool          `mapstructure:"auto_migrate" json:"auto_migrate"`
	LogLevel        string        `mapstructure:"log_level" json:"log_level"`
}

type LogConfig struct {
	Level      string `mapstructure:"level" json:"level"`
	Format     string `mapstructure:"format" json:"format"`
	Output     string `mapstructure:"output" json:"output"`
	FilePath   string `mapstructure:"file_path" json:"file_path"`
	MaxSize    int    `mapstructure:"max_size" json:"max_size"`
	MaxBackups int    `mapstructure:"max_backups" json:"max_backups"`
	MaxAge     int    `mapstructure:"max_age" json:"max_age"`
	Compress   bool   `mapstructure:"compress" json:"compress"`
}
